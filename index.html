<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Serene Verse</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="favicon.svg" type="image/svg+xml">
  <style>
    :root {
      --bg: #181b1f;
      --card-bg: #23262b;
      --text: #e9eef3;
      --accent: #6caee0;
      --border: #2d3440;
      --verse-font: 'Georgia', serif;
      --transition: 0.4s cubic-bezier(.4,0,.2,1);
      --overlay: rgba(24,27,31,0.85);
      --menu-divider: #22242a;
      --source: #fff;
    }
    html, body {
      height: 100%;
      width: 100vw;
      margin: 0;
      padding: 0;
      background: var(--bg);
      color: var(--text);
      font-family: 'Roboto', Arial, sans-serif;
      min-height: 100vh;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    body {
      min-height: 100vh;
      width: 100vw;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      background: linear-gradient(135deg, #181b1f 0%, #23262b 100%);
      position: relative;
    }
    .container {
      width: 100vw;
      max-width: 100vw;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 9vh;
      padding-bottom: 0;
      box-sizing: border-box;
      overflow-x: hidden;
    }
    .topbar {
      width: 100vw;
      height: 0;
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10;
    }
    .hamburger {
      position: absolute;
      top: 22px;
      left: 22px;
      width: 34px;
      height: 34px;
      background: none;
      border: none;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      z-index: 20;
      padding: 0;
    }
    .hamburger span {
      display: block;
      width: 24px;
      height: 3px;
      background: var(--accent);
      border-radius: 2px;
      margin: 3px 0;
      transition: all .3s;
    }
    h1 {
      font-weight: 400;
      font-size: 2.1rem;
      margin-bottom: 2.2em;
      letter-spacing: .02em;
      color: var(--accent);
      width: 100vw;
      text-align: center;
    }
    .form-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      width: 100vw;
      max-width: 400px;
      margin: 0 auto;
      padding: 0 1em;
      box-sizing: border-box;
      gap: 1.2em;
    }
    label {
      font-size: 1.09em;
      font-weight: 500;
      color: var(--accent);
      margin-bottom: .7em;
      letter-spacing: .02em;
      text-align: left;
      width: 100%;
      display: block;
      padding-left: .1em;
    }
    select {
      width: 100%;
      padding: 0.7em 1em;
      font-size: 1.07em;
      border-radius: 10px;
      border: none;
      margin-bottom: .3em;
      background: #23262b;
      color: var(--text);
      box-shadow: 0 2px 10px #1b1e24;
      outline: none;
      transition: background var(--transition);
      appearance: none;
    }
    select:focus {
      background: var(--card-bg);
    }
    button[type="submit"] {
      width: 70%;
      max-width: 210px;
      min-width: 120px;
      padding: 0.62em 0;
      border-radius: 18px;
      border: none;
      background: var(--accent);
      color: #fff;
      font-size: 1.01em;
      font-weight: 500;
      cursor: pointer;
      margin-bottom: 1.2em;
      margin-top: 0em;
      transition: background var(--transition);
      box-shadow: 0 2px 8px #1b1e24;
      letter-spacing: .02em;
      align-self: center;
    }
    button[type="submit"]:active {
      background: #5b99c7;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 6px 36px 0 #16181c;
      padding: 2em 1.2em 2.5em 1.2em;
      margin-top: 2em;
      margin-bottom: 2em;
      min-height: 180px;
      max-width: 400px;
      text-align: left;
      position: relative;
      transition: box-shadow var(--transition), opacity var(--transition), transform var(--transition);
      opacity: 0;
      transform: translateY(20px);
      font-size: 1.04rem;
      border: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      box-sizing: border-box;
      overflow: visible;
      margin-left: auto;
      margin-right: auto;
    }
    .card.show {
      opacity: 1;
      transform: translateY(0);
    }
    .verse-block {
      width: 100%;
      padding-bottom: 1.1em;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      position: relative;
    }
    .verse {
      font-family: var(--verse-font);
      font-size: 1.13em;
      margin-bottom: 0.3em;
      color: var(--text);
      line-height: 1.65;
      letter-spacing: .01em;
      text-align: left;
      font-style: italic;
      word-break: break-word;
      max-width: 97%;
      display: block;
      padding: 0 .1em 0 .1em;
      margin-right: 0;
    }
    .verse-ref {
      color: var(--source);
      font-size: 1em;
      margin-top: .6em;
      margin-bottom: 0;
      text-align: right;
      letter-spacing: .01em;
      word-break: break-word;
      max-width: 99%;
      align-self: flex-end;
      background: none;
      display: block;
      font-style: normal;
    }
    .tafsir-toggle {
      display: inline-block;
      color: var(--accent);
      background: none;
      border: none;
      font-size: 1em;
      cursor: pointer;
      text-decoration: underline;
      margin-bottom: 1em;
      margin-top: .3em;
      padding: 0;
      transition: color var(--transition);
      align-self: center;
    }
    .tafsir {
      margin-top: 1.1em;
      font-size: 1.05em;
      color: #c7d5e0;
      background: #22242a;
      padding: 1.1em 1em;
      border-radius: 12px;
      display: none;
      line-height: 1.6;
      text-align: center;
      letter-spacing: .01em;
      word-break: break-word;
      max-width: 96%;
    }
    /* Drawer styles */
    .drawer {
      position: fixed;
      top: 0; left: 0;
      width: 290px;
      max-width: 90vw;
      height: 100vh;
      background: var(--card-bg);
      box-shadow: 2px 0 18px #16181c;
      border-right: 1px solid var(--border);
      z-index: 30;
      transform: translateX(-100%);
      transition: transform .35s cubic-bezier(.5,0,.2,1);
      display: flex;
      flex-direction: column;
      padding: 2.5em 1.3em 1em 1.3em;
    }
    .drawer.open {
      transform: translateX(0);
    }
    .drawer-close {
      background: none;
      border: none;
      color: var(--accent);
      font-size: 2em;
      position: absolute;
      top: 18px;
      right: 18px;
      cursor: pointer;
      opacity: 0.7;
      z-index: 31;
      transition: opacity .2s;
    }
    .drawer-close:active { opacity: 1; }
    .prayer-title {
      font-weight: 500;
      margin-bottom: 2em;
      color: var(--accent);
      font-size: 1.16em;
      text-align: left;
      letter-spacing: .03em;
    }
    .menu-times {
      display: flex;
      flex-direction: column;
      gap: 1.5em;
      margin-bottom: 2em;
    }
    .menu-item {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      justify-content: flex-start;
      padding-bottom: .9em;
      border-bottom: 1px solid var(--menu-divider);
      min-width: 140px;
      font-size: 1em;
    }
    .menu-item:last-child {
      border-bottom: none;
      padding-bottom: 0;
    }
    .menu-label {
      font-size: 1.06em;
      font-weight: 500;
      color: var(--accent);
      margin-bottom: .15em;
      letter-spacing: .03em;
    }
    .menu-value {
      font-size: .99em;
      color: var(--text);
      font-weight: 400;
      letter-spacing: .01em;
      padding-bottom: .12em;
    }
    .overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: var(--overlay);
      z-index: 29;
      opacity: 0;
      pointer-events: none;
      transition: opacity .32s cubic-bezier(.5,0,.2,1);
    }
    .overlay.open {
      opacity: 1;
      pointer-events: all;
    }
    .footer {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100vw;
      text-align: center;
      background: transparent;
      color: #b6e0ff;
      font-size: 1.09em;
      letter-spacing: .01em;
      opacity: .65;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: .2em;
      min-height: 2.5em;
      z-index: 40;
      padding-bottom: .9em;
      padding-top: .7em;
    }
    .footer .heart {
      color: #e57373;
      font-size: 1.13em;
      margin: 0 .18em;
      vertical-align: middle;
      display: inline-block;
      animation: heartBeat .9s infinite alternate;
    }
    .footer .queen {
      font-size: 1.2em;
      margin-left: .18em;
      vertical-align: middle;
      display: inline-block;
    }
    @keyframes heartBeat {
      to { transform: scale(1.14); }
    }
    @media (max-width: 600px) {
      html, body, .container {
        width: 100vw;
        max-width: 100vw;
        margin: 0;
        padding: 0;
        overflow-x: hidden;
      }
      .container {
        margin-top: 6vh;
        margin-bottom: 7.5em;
        padding: 0;
      }
      .form-wrapper {
        max-width: 99vw;
        padding: 0 .5em;
      }
      .card {
        padding: 1em;
        max-width: 98vw;
      }
      select, button[type="submit"] {
        font-size: 1.03em;
        width: 99vw;
        max-width: none;
      }
      .drawer {
        padding: 1.5em .7em 1em .9em;
        width: 93vw;
      }
      .footer { font-size: 1em;}
    }
  </style>
</head>
<body>
  <div class="topbar">
    <button class="hamburger" id="drawerOpenBtn" aria-label="Open menu">
      <span></span>
      <span></span>
      <span></span>
    </button>
  </div>
  <div class="overlay" id="drawerOverlay"></div>
  <div class="drawer" id="drawer">
    <button class="drawer-close" id="drawerCloseBtn" aria-label="Close menu">&times;</button>
    <div class="prayer-title">Prayer Time</div>
    <div class="menu-times" id="drawerPrayerTimes"></div>
  </div>
  <div class="container">
    <h1>Serene Verse</h1>
    <form id="feeling-form" autocomplete="off">
      <div class="form-wrapper">
        <label for="feeling">Feelingâ€¦?</label>
        <select id="feeling" required>
          <option value="" disabled selected>Choose</option>
          <option value="sad">Sad</option>
          <option value="anxious">Anxious</option>
          <option value="hopeful">Hopeful</option>
          <option value="grateful">Grateful</option>
          <option value="angry">Angry</option>
          <option value="lost">Lost</option>
          <option value="fearful">Fearful</option>
          <option value="happy">Happy</option>
          <option value="seeking-guidance">Seeking Guidance</option>
          <option value="stressed">Stressed</option>
          <option value="lonely">Lonely</option>
          <option value="thankful">Thankful</option>
          <option value="seeking-forgiveness">Seeking Forgiveness</option>
          <option value="content">Content</option>
          <option value="forgiven">Forgiven</option>
          <option value="calm">Calm</option>
          <option value="confident">Confident</option>
          <option value="patient">Patient</option>
          <option value="forbearing">Forbearing</option>
          <option value="trust">Trust</option>
          <option value="repentant">Repentant</option>
          <option value="forgiving">Forgiving</option>
          <option value="generous">Generous</option>
        </select>
        <button type="submit">Reveal Wisdom</button>
      </div>
    </form>
    <div id="result" class="card"></div>
  </div>
  <div class="footer">
    Made with <span class="heart">&#10084;</span> for Allah for my<span class="queen">&#x1F478;&#x1F3FB;</span>
  </div>
  <script>
    // Clear cache on load for freshness
    if ('caches' in window) {
      caches.keys().then(function(names) {
        for (let name of names) caches.delete(name);
      });
    }
    let entries = [];
    let feelingsMap = {};

    // Load entries.json and map by feeling
    fetch("entries.json")
      .then(res => res.json())
      .then(data => {
        entries = data;
        feelingsMap = {};
        for (const entry of entries) {
          if (!feelingsMap[entry.feeling]) feelingsMap[entry.feeling] = [];
          feelingsMap[entry.feeling].push(entry);
        }
      });

    function pickRandom(arr) {
      return arr[Math.floor(Math.random() * arr.length)];
    }

    const resultDiv = document.getElementById('result');
    document.getElementById('feeling-form').addEventListener('submit', function(e) {
      e.preventDefault();
      const feeling = document.getElementById('feeling').value;
      if (feelingsMap[feeling]) {
        const entry = pickRandom(feelingsMap[feeling]);
        resultDiv.innerHTML = `
          <div class="verse-block">
            <span class="verse">${entry.text}</span>
            <span class="verse-ref">- ${entry.ref}</span>
          </div>
          <button class="tafsir-toggle">See Meaning</button>
          <div class="tafsir">${entry.tafsir}</div>
        `;
        resultDiv.classList.remove('show');
        setTimeout(() => resultDiv.classList.add('show'), 30);
        // Tafsir toggle
        const tafsirToggle = resultDiv.querySelector('.tafsir-toggle');
        const tafsirDiv = resultDiv.querySelector('.tafsir');
        tafsirToggle.onclick = function() {
          if (tafsirDiv.style.display === 'block') {
            tafsirDiv.style.display = 'none';
            tafsirToggle.textContent = 'See Meaning';
          } else {
            tafsirDiv.style.display = 'block';
            tafsirToggle.textContent = 'Hide Meaning';
          }
        };
      } else {
        resultDiv.innerHTML = '';
        resultDiv.classList.remove('show');
      }
    });

    // Drawer logic
    const drawer = document.getElementById('drawer');
    const drawerOverlay = document.getElementById('drawerOverlay');
    const drawerOpenBtn = document.getElementById('drawerOpenBtn');
    const drawerCloseBtn = document.getElementById('drawerCloseBtn');
    drawerOpenBtn.onclick = () => {
      drawer.classList.add('open');
      drawerOverlay.classList.add('open');
      getPrayerTimesDrawer();
    };
    drawerCloseBtn.onclick = () => {
      drawer.classList.remove('open');
      drawerOverlay.classList.remove('open');
    };
    drawerOverlay.onclick = () => {
      drawer.classList.remove('open');
      drawerOverlay.classList.remove('open');
    };

    // Prayer Time Drawer (Aladhan, Doha Qatar)

    // Prayer Time Drawer (Aladhan, Doha Qatar) with offsets
async function getPrayerTimesDrawer() {
  function offsetTime(timeStr, offsetMinutes) {
    // timeStr is "HH:MM"
    let [h, m] = timeStr.split(":").map(Number);
    let d = new Date();
    d.setHours(h, m, 0, 0);
    d.setMinutes(d.getMinutes() + offsetMinutes);
    let oh = d.getHours().toString().padStart(2, "0");
    let om = d.getMinutes().toString().padStart(2, "0");
    return `${oh}:${om}`;
  }

  try {
    const resp = await fetch('https://api.aladhan.com/v1/timingsByCity?city=Doha&country=Qatar&method=2');
    const data = await resp.json();
    const t = data.data.timings;
    const menuTimes = [
      { label: "Fajr", value: offsetTime(t.Fajr, -12) },
      { label: "Sunrise", value: t.Sunrise },
      { label: "Dhuhr", value: t.Dhuhr },
      { label: "Asr", value: t.Asr },
      { label: "Maghrib", value: offsetTime(t.Maghrib, 1) },
      { label: "Isha", value: offsetTime(t.Isha, 27) }
    ];
    document.getElementById('drawerPrayerTimes').innerHTML = menuTimes.map(item =>
      `<div class="menu-item">
        <div class="menu-label">${item.label}</div>
        <div class="menu-value">${item.value}</div>
      </div>`
    ).join('');
  } catch {
    document.getElementById('drawerPrayerTimes').innerHTML = '<div class="menu-item">Unable to load prayer times.</div>';
  }
}
    window.onload = () => {
      document.body.style.minHeight = window.innerHeight + "px";
      document.body.style.width = window.innerWidth + "px";
      document.documentElement.style.width = "100vw";
    };
  </script>
</body>
</html>